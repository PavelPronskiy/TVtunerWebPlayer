/**
 * jQuery VGrid v0.1.8 - variable grid layout plugin
 *
 * Terms of Use - jQuery VGrid
 * under the MIT (http://www.opensource.org/licenses/mit-license.php) License.
 *
 * Copyright 2009-2012 xlune.com All rights reserved.
 * (http://blog.xlune.com/2009/09/jqueryvgrid.html)
 */
(function(g){function i(a){var b=a.data("_vgchild"),c=[[0,a.width(),0]],h=0,e,d,j;b.each(function(){e=g(this);if("none"==e.css("display"))return!0;var a=e.width(),b=e.height(),a=a+(Number(e.css("margin-left").replace("px",""))+Number(e.css("padding-left").replace("px",""))+Number(e.get(0).style.borderLeftWidth.replace("px",""))+Number(e.css("margin-right").replace("px",""))+Number(e.css("padding-right").replace("px",""))+Number(e.get(0).style.borderRightWidth.replace("px",""))),b=b+(Number(e.css("margin-top").replace("px",
""))+Number(e.css("padding-top").replace("px",""))+Number(e.get(0).style.borderTopWidth.replace("px",""))+Number(e.css("margin-bottom").replace("px",""))+Number(e.css("padding-bottom").replace("px",""))+Number(e.get(0).style.borderBottomWidth.replace("px","")));d=[a,b];a:{for(var a=d[0],b=c.concat().sort(q),f=b[b.length-1][2],k=0,o=b.length;k<o&&!(b[k][2]>=f);k++)if(b[k][1]-b[k][0]>=a){j=[b[k][0],b[k][2]];break a}j=[0,f]}b=j;a=c.concat().sort(q);b=[b[0],b[0]+d[0],b[1]+d[1]];f=0;for(k=a.length;f<k;f++)if(b[0]<=
a[f][0]&&a[f][1]<=b[1])delete a[f];else{var o=a,i=f,l=a[f],n=b;if(l[0]>=n[0]&&l[0]<n[1]||l[1]>=n[0]&&l[1]<n[1])l[0]>=n[0]&&l[0]<n[1]?l[0]=n[1]:l[1]=n[0];o[i]=l}a=a.concat([b]).sort(s);b=[];f=0;for(k=a.length;f<k;f++)a[f]&&(0<b.length&&b[b.length-1][1]==a[f][0]&&b[b.length-1][2]==a[f][2]?b[b.length-1][1]=a[f][1]:b.push(a[f]));c=b;h=Math.max(h,j[1]+d[1]);e.data("_vgleft",j[0]);e.data("_vgtop",j[1])});a.data("_vgwrapheight",h);t(a)}function q(a,b){return!a||!b?0:a[2]==b[2]&&a[0]>b[0]||a[2]>b[2]?1:-1}
function s(a,b){return!a||!b?0:a[0]>b[0]?1:-1}function t(a){var b=a.data("_vgchild").length*(a.data("_vgopt").delay||0)+a.data("_vgopt").time||500;a.stop();a.height()<a.data("_vgwrapheight")?g.browser.msie?a.height(a.data("_vgwrapheight")):a.animate({height:a.data("_vgwrapheight")+"px"},a.data("_vgopt").time||500,"easeOutQuart"):(clearTimeout(a.data("_vgwraptimeout")),a.data("_vgwraptimeout",setTimeout(function(){g.browser.msie?a.height(a.data("_vgwrapheight")):a.animate({height:a.data("_vgwrapheight")+
"px"},a.data("_vgopt").time||500,"easeOutQuart")},b)))}function u(a){var b;a.each(function(){b=g(this);b.css("left",b.data("_vgleft")+"px");b.css("top",b.data("_vgtop")+"px")})}function p(a,b,c,h){var e=g(a).parent(),d=!1,j=a.length,i,m,f;for(i=0;i<j;i++)if(m=g(a[i]),f=m.position(),f.left!=m.data("_vgleft")||f.top!=m.data("_vgtop"))d=!0;if(d){if("function"==typeof e.data("_vgopt").onStart)e.data("_vgopt").onStart();a.each(function(d){var f=g(this),j={duration:c,easing:b};a.size()-1==d&&(j.complete=
e.data("_vgopt").onFinish||null);clearTimeout(f.data("_vgtimeout"));f.data("_vgtimeout",setTimeout(function(){f.animate({left:f.data("_vgleft")+"px",top:f.data("_vgtop")+"px"},j)},d*h))})}}function m(a){a.each(function(){var a=g(this);clearTimeout(a.data("_vgtimeout"));a.data("_vgtimeout",setTimeout(function(){i(a);p(a.data("_vgchild"),a.data("_vgopt").easing||"linear",a.data("_vgopt").time||500,a.data("_vgopt").delay||0)},500))})}function v(a,b){var c=g("<span />").text(" ").attr("id","_vgridspan").hide().appendTo("body");
c.data("size",c.css("font-size"));c.data("timer",setInterval(function(){c.css("font-size")!=c.data("size")&&(c.data("size",c.css("font-size")),b(a))},1E3))}function r(a,b){a.data("vgrid-image-event-added")||(a.data("vgrid-image-event-added",1),a.bind("vgrid-added",function(){a.find("img").each(function(){var e=g(this);e.data("vgrid-image-handler")||(e.data("vgrid-image-handler",1),e.bind("load",function(){b(a)}))})}));a.trigger("vgrid-added");var c=a.append,h=a.prepend;a.append=function(){c.apply(a,
arguments);a.trigger("vgrid-added")};a.prepend=function(){h.apply(a,arguments);a.trigger("vgrid-added")}}g.fn.extend({vgrid:function(a){var b=g(this),c=a||{};c.easeing&&(c.easing=c.easeing);b.each(function(){var a=g(this);a.data("_vgopt",c);a.data("_vgchild",a.find("> *"));a.data("_vgdefchild",a.data("_vgchild"));a.css({position:"relative",width:"auto"});a.data("_vgchild").css("position","absolute");i(a);u(a.data("_vgchild"));if(a.data("_vgopt").fadeIn){var b=typeof a.data("_vgopt").fadeIn=="object"?
a.data("_vgopt").fadeIn:{time:a.data("_vgopt").fadeIn};a.data("_vgchild").each(function(a){var c=g(this);if(c.css("display")=="none")return true;c.stop().fadeTo(0,0);setTimeout(function(){c.stop().fadeTo(b.time||250,1)},a*(b.delay||0))})}g(window).resize(function(){m(a)});c.useLoadImageEvent&&r(a,m);c.useFontSizeListener&&v(a,m)});return b},vgrefresh:function(a,b,c,h){var e=g(this);e.each(function(){var d=g(this),e=d.data("_vgopt")||{};d.data("_vgchild")&&(d.data("_vgchild",d.find("> *")),d.data("_vgchild").css("position",
"absolute"),i(d),b="number"==typeof b?b:d.data("_vgopt").time||500,c="number"==typeof c?c:d.data("_vgopt").delay||0,p(d.data("_vgchild"),a||d.data("_vgopt").easing||"linear",b,c),"function"==typeof h&&setTimeout(h,d.data("_vgchild").length*c+b));e.useLoadImageEvent&&r(d,m)});return e},vgsort:function(a,b,c,h){var e=g(this);e.each(function(){var d=g(this);d.data("_vgchild")&&(d.data("_vgchild",d.data("_vgchild").sort(a)),d.data("_vgchild").each(function(){g(this).appendTo(d)}),i(d),p(d.data("_vgchild"),
b||d.data("_vgopt").easing||"linear","number"==typeof c?c:d.data("_vgopt").time||500,"number"==typeof h?h:d.data("_vgopt").delay||0))});return e}})})(jQuery);
